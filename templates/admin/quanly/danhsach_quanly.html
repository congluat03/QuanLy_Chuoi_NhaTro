{% extends 'admin/admin_layout.html' %}
{% load static %}
{% load custom_filters %}

{% block content_body %}
<div class="bg-white shadow-xl rounded-2xl p-6 sm:p-8">
    <div class="container mx-auto px-4">
        <!-- Main White Container -->
        <div class="bg-white rounded-xl shadow-xl overflow-hidden">
            <!-- Header Section -->
           <div class="bg-gray-50 border-b border-gray-200 p-6">
  <div class="flex items-center justify-between">
    <!-- Left: Icon + Title -->
    <div class="flex items-center space-x-4">
      <div class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
        <i class="fas fa-users text-gray-700 text-xl"></i>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Quản lý Nhân viên</h1>
        <p class="text-gray-600 text-sm">Quản lý thông tin nhân viên theo từng khu vực</p>
      </div>
    </div>
    <!-- Right: Button -->
    <a href="{% url 'thanhvien:add_manager' %}" 
       class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors shadow-sm">
      <i class="fas fa-plus mr-2"></i>Thêm nhân viên
    </a>
  </div>
</div>

            <!-- Content Container -->
            <div class="flex">
                <!-- Left Sidebar - Danh sách khu vực (25%) -->
                <div class="w-1/4 border-r border-gray-200 bg-gray-50">
                    <!-- Sidebar Header -->
                    <div class="p-4 border-b border-gray-200 bg-white">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>
                            Danh sách khu vực
                        </h3>
                        <p class="text-sm text-gray-600">Chọn khu vực để lọc nhân viên</p>
                    </div>
                    
                    <!-- Area List -->
                    <div class="p-4 space-y-2 max-h-96 overflow-y-auto">
                        <!-- Tất cả khu vực -->
                        <div class="khu-vuc-item cursor-pointer p-3 rounded-lg border-2 border-blue-500 bg-blue-50 transition-all duration-200"
                             data-khu-vuc="all">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-globe text-blue-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 text-sm">Tất cả khu vực</h4>
                                        <p class="text-xs text-gray-500">{{ quan_lys.count }} nhân viên</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% for khu_vuc in khu_vucs %}
                        <div class="khu-vuc-item cursor-pointer p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200"
                             data-khu-vuc="{{ khu_vuc.MA_KHU_VUC }}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-building text-green-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 text-sm">{{ khu_vuc.TEN_KHU_VUC }}</h4>
                                        <p class="text-xs text-gray-500">
                                            {{ quan_ly_by_khu_vuc|count_employees_in_area:khu_vuc.MA_KHU_VUC }} nhân viên
                                        </p>
                                    </div>
                                </div>
                                <div class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">
                                    #{{ khu_vuc.MA_KHU_VUC }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}

                        <!-- Chưa phân công -->
                        {% if quan_ly_no_area %}
                        <div class="khu-vuc-item cursor-pointer p-3 rounded-lg border border-gray-200 hover:border-orange-300 hover:bg-orange-50 transition-all duration-200"
                             data-khu-vuc="no-area">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-user-times text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 text-sm">Chưa phân công</h4>
                                        <p class="text-xs text-gray-500">{{ quan_ly_no_area|length }} nhân viên</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Right Content - 75% -->
                <div class="flex-1">
                    <!-- Toolbar Section -->
                    <div class="p-4 border-b border-gray-200 bg-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900" id="selectedAreaTitle">
                                    Tất cả nhân viên
                                </h3>
                                <p class="text-sm text-gray-600" id="selectedAreaInfo">
                                    Hiển thị toàn bộ danh sách nhân viên
                                </p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <!-- Search -->
                                <div class="relative w-72">
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    placeholder="Tìm kiếm nhân viên..." 
                                    value="{{ search_query }}"
                                    class="w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-xl shadow-sm 
                                        focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent 
                                        placeholder-gray-400 transition duration-200"
                                >
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                </div>

                                
                                <!-- Filter buttons -->
                                <div class="flex space-x-2">
                                    <button type="button" 
                                            class="filter-btn active px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 border border-blue-200">
                                        Tất cả
                                    </button>
                                    <button type="button" 
                                            class="filter-btn px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200">
                                        Hoạt động
                                    </button>
                                    <button type="button" 
                                            class="filter-btn px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200">
                                        Đã nghỉ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Table Section -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STT</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nhân viên</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thông tin</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Khu vực quản lý</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for manager in quan_lys %}
                                <tr class="employee-row hover:bg-gray-50 transition-colors"
                                    data-status="{% if manager.MA_TAI_KHOAN.TRANG_THAI_TK == 'Hoạt động' %}active{% elif manager.MA_TAI_KHOAN.TRANG_THAI_TK == 'Đã nghỉ' %}resigned{% else %}probation{% endif %}"
                                    data-khu-vuc="{% if manager.current_khu_vuc %}{{ manager.current_khu_vuc.MA_KHU_VUC.MA_KHU_VUC }}{% else %}no-area{% endif %}">
                                    <td class="px-4 py-3 text-sm text-gray-900">
                                        {{ forloop.counter }}
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center">
                                            <!-- Avatar -->
                                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                                {{ manager.TEN_QUAN_LY|slice:":1"|upper|default:"N" }}
                                            </div>
                                            <div>
                                                <div class="font-medium text-gray-900">
                                                    {{ manager.TEN_QUAN_LY|default:"Chưa cập nhật" }}
                                                </div>
                                                <div class="text-sm text-gray-500">
                                                    {{ manager.GIOI_TINH_QL|default:"Chưa cập nhật" }}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-900">
                                        <div class="space-y-1">
                                            <div class="flex items-center text-sm">
                                                <i class="fas fa-phone w-4 text-gray-400 mr-2"></i>
                                                {{ manager.SDT_QUAN_LY|default:"Chưa cập nhật" }}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <i class="fas fa-birthday-cake w-4 text-gray-400 mr-2"></i>
                                                {{ manager.NGAY_SINH_QL|date:"d/m/Y"|default:"Chưa cập nhật" }}
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3">
                                        {% if manager.current_khu_vuc %}
                                            <div class="space-y-2">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                                    {{ manager.current_khu_vuc.MA_KHU_VUC.TEN_KHU_VUC }}
                                                </span>
                                                {% if manager.current_khu_vuc.VI_TRI_CONG_VIEC %}
                                                    <div class="text-xs text-blue-600 font-medium">
                                                        {{ manager.current_khu_vuc.VI_TRI_CONG_VIEC }}
                                                    </div>
                                                {% endif %}
                                                <div class="text-xs text-gray-500">
                                                    Từ {{ manager.current_khu_vuc.NGAY_BAT_DAU_QL|date:"d/m/Y" }}
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                                Chưa phân công
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="px-4 py-3">
                                        {% if manager.MA_TAI_KHOAN.TRANG_THAI_TK == 'Hoạt động' %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                <span class="w-1.5 h-1.5 bg-green-400 rounded-full mr-1.5"></span>
                                                Hoạt động
                                            </span>
                                        {% elif manager.MA_TAI_KHOAN.TRANG_THAI_TK == 'Đã nghỉ' %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                <span class="w-1.5 h-1.5 bg-red-400 rounded-full mr-1.5"></span>
                                                Đã nghỉ
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                <span class="w-1.5 h-1.5 bg-yellow-400 rounded-full mr-1.5"></span>
                                                Thử việc
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <div class="relative inline-block">
                                            <div class="inline-flex items-center justify-center w-8 h-8 bg-gray-200 rounded-full cursor-pointer hover:bg-gray-300 transition tooltipQuanLy" onclick="toggleMenuQuanLy({{ manager.MA_QUAN_LY }})">
                                                <i class="fas fa-ellipsis-v text-gray-600"></i>
                                            </div>
                                            
                                            <!-- Dropdown menu -->
                                            <div onmouseleave="hideMenuQuanLy({{ manager.MA_QUAN_LY }})" 
                                                 class="absolute right-0 mt-2 w-64 origin-top-right bg-white border border-gray-200 rounded-xl shadow-lg z-20 hidden" 
                                                 id="menuQuanLy-{{ manager.MA_QUAN_LY }}">
                                                
                                               
                                                
                                                <a href="{% url 'thanhvien:edit_manager' manager.MA_QUAN_LY %}" 
                                                   class="block px-4 py-2 text-blue-600 text-sm hover:bg-blue-50 rounded flex items-center">
                                                    <i class="fas fa-user-edit mr-2"></i> Chỉnh sửa thông tin
                                                </a>
                                                                                                                                                                                                                                      
                                                <a href="{% url 'thanhvien:transfer_manager_area' manager.MA_QUAN_LY %}"
                                                   class="block px-4 py-2 text-gray-700 text-sm hover:bg-gray-100 rounded flex items-center">
                                                    <i class="fas fa-exchange-alt mr-2"></i> Chuyển khu vực
                                                </a>
                                                                                                                                                                        
    
                                                <!-- Danger Zone -->
                                                <hr class="my-2 border-gray-200">
                                                <form action="{% url 'thanhvien:delete_manager' manager.MA_QUAN_LY %}" method="post" class="inline-block" 
                                                      onsubmit="return confirm('Bạn có chắc chắn muốn xóa nhân viên này?\n\nTất cả lịch sử quản lý sẽ được kết thúc và không thể khôi phục.')">
                                                    {% csrf_token %}
                                                    <button type="submit" 
                                                            class="block px-4 py-2 text-red-600 text-sm hover:bg-gray-100 rounded flex items-center">
                                                        <i class="fas fa-trash mr-2"></i></i> Xóa nhân viên
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="px-4 py-12 text-center">
                                        <div class="text-gray-500">
                                            <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                            <p>Không có nhân viên nào</p>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                        <!-- Empty state khi filter -->
                        <div id="empty-state" class="hidden">
                            <div class="text-center py-12">
                                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">Không tìm thấy nhân viên</h3>
                                <p class="text-gray-500">
                                    Không có nhân viên nào trong khu vực này hoặc thỏa mãn điều kiện tìm kiếm.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    {% if quan_lys.has_other_pages %}
                    <div class="px-4 py-3 border-t border-gray-200 bg-gray-50">
                        <div class="flex items-center justify-center">
                            <nav class="flex space-x-2">
                                {% if quan_lys.has_previous %}
                                <a href="?{% if employee_filter %}employee_filter={{ employee_filter|join:'&employee_filter=' }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}page={{ quan_lys.previous_page_number }}" 
                                   class="px-3 py-1 text-sm bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50">
                                   Trước
                                </a>
                                {% endif %}
                                
                                {% for num in quan_lys.paginator.page_range %}
                                <a href="?{% if employee_filter %}employee_filter={{ employee_filter|join:'&employee_filter=' }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}page={{ num }}" 
                                   class="{% if quan_lys.number == num %}bg-blue-600 text-white{% else %}bg-white text-gray-700 hover:bg-gray-50{% endif %} px-3 py-1 text-sm border border-gray-300 rounded">
                                   {{ num }}
                                </a>
                                {% endfor %}
                                
                                {% if quan_lys.has_next %}
                                <a href="?{% if employee_filter %}employee_filter={{ employee_filter|join:'&employee_filter=' }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}page={{ quan_lys.next_page_number }}" 
                                   class="px-3 py-1 text-sm bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50">
                                   Sau
                                </a>
                                {% endif %}
                            </nav>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include CSS for animations -->
<style>
.menu-dropdown {
    transform: translateY(-10px);
    opacity: 0;
    transition: all 0.15s ease-out;
}

.menu-dropdown.show {
    transform: translateY(0);
    opacity: 1;
}

.tooltipQuanLy:hover {
    transform: scale(1.05);
    transition: transform 0.1s ease;
}

.menu-item:hover {
    transform: translateX(2px);
    transition: transform 0.1s ease;
}

/* Custom scrollbar for menu if needed */
.menu-dropdown::-webkit-scrollbar {
    width: 4px;
}

.menu-dropdown::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
}

.menu-dropdown::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
}

.menu-dropdown::-webkit-scrollbar-thumb:hover {
    background: #a1a1a1;
}

/* Ripple effect for menu button */
.tooltipQuanLy {
    position: relative;
    overflow: hidden;
}

.tooltipQuanLy::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.3s, height 0.3s;
}

.tooltipQuanLy:active::after {
    width: 100px;
    height: 100px;
}
</style>

<!-- Include JS -->
<script src="{% static 'js/admin/quanly/quanly.js' %}"></script>
<script>
// Wait for jQuery to be available
(function() {
    'use strict';
    
    // Check if jQuery is loaded
    function waitForJQuery(callback) {
        if (typeof jQuery !== 'undefined') {
            callback(jQuery);
        } else {
            setTimeout(function() {
                waitForJQuery(callback);
            }, 50);
        }
    }
    
    waitForJQuery(function($) {
        // Define global variables
        let currentKhuVuc = 'all';
        let currentStatus = 'all';
        let searchQuery = '';

        // Menu functions - Global functions (similar to hợp đồng)
        window.toggleMenuQuanLy = function(managerId) {
            const menu = document.getElementById("menuQuanLy-" + managerId);

            // Ẩn tất cả các menu khác
            const allMenus = document.querySelectorAll("[id^='menuQuanLy-']");
            allMenus.forEach((m) => {
                if (!m.classList.contains("hidden")) {
                    m.classList.add("hidden");
                    // Đồng thời bỏ luôn sự kiện mouseleave cũ để tránh bị dính nhiều lần
                    m.onmouseleave = null;
                }
            });

            // Nếu menu đang hiển thị => ẩn
            if (!menu.classList.contains("hidden")) {
                menu.classList.add("hidden");
                menu.onmouseleave = null;
                return;
            }

            // Xử lý vị trí nếu bị tràn màn hình
            menu.classList.remove("top-8");
            menu.classList.remove("bottom-full");

            // Reset lại vị trí để đo đúng
            menu.style.top = "";
            menu.style.bottom = "";

            // Tạm thời hiển thị để đo vị trí
            menu.classList.remove("hidden");

            const rect = menu.getBoundingClientRect();
            const windowHeight = window.innerHeight;

            // Nếu bị tràn dưới thì hiển thị menu lên trên
            if (rect.bottom > windowHeight) {
                menu.classList.add("bottom-full");
                menu.classList.remove("top-8");
            } else {
                menu.classList.add("top-8");
                menu.classList.remove("bottom-full");
            }

            // Hiển thị menu
            menu.classList.remove("hidden");

            // Thêm sự kiện khi chuột rời khỏi menu thì ẩn menu
            menu.onmouseleave = () => {
                menu.classList.add("hidden");
                menu.onmouseleave = null; // gỡ sự kiện sau khi ẩn menu
            };
        };

        window.hideMenuQuanLy = function(managerId) {
            const menu = document.getElementById("menuQuanLy-" + managerId);
            if (menu) {
                menu.classList.add("hidden");
                menu.onmouseleave = null;
            }
        };

        // Area selection - Global function
        window.selectKhuVuc = function(khuVucId) {
            currentKhuVuc = khuVucId;
            
            // Update UI
            $('.khu-vuc-item').removeClass('border-blue-500 bg-blue-50').addClass('border-gray-200');
            $(`.khu-vuc-item[data-khu-vuc="${khuVucId}"]`).addClass('border-blue-500 bg-blue-50').removeClass('border-gray-200');
            
            // Update title
            if (khuVucId === 'all') {
                $('#selectedAreaTitle').text('Tất cả nhân viên');
                $('#selectedAreaInfo').text('Hiển thị toàn bộ danh sách nhân viên');
            } else if (khuVucId === 'no-area') {
                $('#selectedAreaTitle').text('Nhân viên chưa phân công');
                $('#selectedAreaInfo').text('Hiển thị nhân viên chưa được phân công khu vực');
            } else {
                const areaName = $(`.khu-vuc-item[data-khu-vuc="${khuVucId}"] h4`).text();
                $('#selectedAreaTitle').text(`Khu vực: ${areaName}`);
                $('#selectedAreaInfo').text(`Hiển thị nhân viên của khu vực ${areaName}`);
            }
            
            filterEmployees();
        };

        // Status filter - Global function
        window.filterByStatus = function(status) {
            currentStatus = status;
            
            // Update UI
            $('.filter-btn').removeClass('active bg-blue-100 text-blue-700').addClass('bg-gray-100 text-gray-700');
            $(`.filter-btn`).eq(status === 'all' ? 0 : (status === 'active' ? 1 : 2))
                .addClass('active bg-blue-100 text-blue-700').removeClass('bg-gray-100 text-gray-700');
            
            filterEmployees();
        };

        // Filter employees based on current criteria - Global function
        window.filterEmployees = function() {
            let visibleCount = 0;
            
            $('.employee-row').each(function() {
                const $row = $(this);
                const rowKhuVuc = $row.data('khu-vuc') ? $row.data('khu-vuc').toString() : '';
                const rowStatus = $row.data('status') || '';
                const rowText = $row.text().toLowerCase();
                
                let showRow = true;
                
                // Filter by area
                if (currentKhuVuc !== 'all' && rowKhuVuc !== currentKhuVuc.toString()) {
                    showRow = false;
                }
                
                // Filter by status
                if (currentStatus !== 'all' && rowStatus !== currentStatus) {
                    showRow = false;
                }
                
                // Filter by search
                if (searchQuery && !rowText.includes(searchQuery)) {
                    showRow = false;
                }
                
                if (showRow) {
                    $row.show();
                    visibleCount++;
                } else {
                    $row.hide();
                }
            });
            
            // Show/hide empty state
            if (visibleCount === 0) {
                $('#empty-state').show();
                $('table').hide();
            } else {
                $('#empty-state').hide();
                $('table').show();
            }
        };

        // Initialize when DOM is ready
        $(document).ready(function() {
            // Area selection event listener
            $('.khu-vuc-item').on('click', function() {
                const khuVucId = $(this).data('khu-vuc');
                selectKhuVuc(khuVucId);
            });

            // Status filter event listeners
            $('.filter-btn').on('click', function() {
                const status = $(this).text().toLowerCase().trim();
                let statusCode = 'all';
                if (status === 'hoạt động') statusCode = 'active';
                else if (status === 'đã nghỉ') statusCode = 'resigned';
                filterByStatus(statusCode);
            });

            // Search functionality
            $('#searchInput').on('input', function() {
                searchQuery = $(this).val().toLowerCase();
                filterEmployees();
            });

            // Close dropdown when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.relative').length && !$(e.target).hasClass('tooltipQuanLy')) {
                    const allMenus = document.querySelectorAll("[id^='menuQuanLy-']");
                    allMenus.forEach((menu) => {
                        menu.classList.add("hidden");
                        menu.onmouseleave = null;
                    });
                }
            });
        });
    });
})();
</script>
{% endblock %}