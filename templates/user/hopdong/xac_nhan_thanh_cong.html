{% extends 'index/index_layout.html' %}

{% block title %}Xác nhận hợp đồng thành công{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Success Message -->
        <div class="bg-white rounded-lg shadow-md p-8 text-center mb-6">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Xác nhận hợp đồng thành công!</h1>
            <p class="text-lg text-gray-600 mb-6">
                Hợp đồng <span class="font-semibold text-blue-600">{{ hop_dong.MA_HOP_DONG }}</span> 
                đã được xác nhận thành công. Hóa đơn bắt đầu đã được tạo.
            </p>
            
            <div class="flex items-center justify-center space-x-2 text-sm text-green-600 mb-6">
                <i class="fas fa-clock"></i>
                <span>Xác nhận lúc: {{ hop_dong.NGAY_KHACH_XAC_NHAN|date:"d/m/Y H:i" }}</span>
            </div>
        </div>

        <!-- Thông tin hợp đồng -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-file-contract text-blue-600 mr-2"></i>
                Thông tin hợp đồng
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phòng</label>
                    <p class="text-gray-900 font-medium">{{ hop_dong.MA_PHONG.TEN_PHONG }}</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Giá thuê</label>
                    <p class="text-gray-900 font-medium">{{ hop_dong.GIA_THUE|floatformat:0 }} VNĐ/tháng</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ngày nhận phòng</label>
                    <p class="text-gray-900 font-medium">{{ hop_dong.NGAY_NHAN_PHONG|date:"d/m/Y" }}</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ngày trả phòng</label>
                    <p class="text-gray-900 font-medium">{{ hop_dong.NGAY_TRA_PHONG|date:"d/m/Y" }}</p>
                </div>
            </div>
        </div>

        <!-- Hóa đơn bắt đầu -->
        {% if hoa_don_bat_dau %}
        <div class="bg-blue-50 rounded-lg border border-blue-200 p-6 mb-6">
            <h2 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                <i class="fas fa-receipt text-blue-600 mr-2"></i>
                Hóa đơn bắt đầu hợp đồng
            </h2>
            
            <div class="bg-white rounded-lg p-4 mb-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mã hóa đơn</label>
                        <p class="text-gray-900 font-medium">{{ hoa_don_bat_dau.MA_HOA_DON }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ngày lập</label>
                        <p class="text-gray-900 font-medium">{{ hoa_don_bat_dau.NGAY_LAP_HDON|date:"d/m/Y" }}</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tiền phòng tháng đầu</label>
                        <p class="text-gray-900 font-medium">{{ hoa_don_bat_dau.TIEN_PHONG|floatformat:0 }} VNĐ</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tiền cọc</label>
                        <p class="text-gray-900 font-medium">{{ hoa_don_bat_dau.TIEN_COC|floatformat:0 }} VNĐ</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tiền dịch vụ</label>
                        <p class="text-gray-900 font-medium">{{ hoa_don_bat_dau.TIEN_DICH_VU|floatformat:0 }} VNĐ</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Trạng thái</label>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                     {% if hoa_don_bat_dau.TRANG_THAI_HDON == 'Đã thanh toán' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ hoa_don_bat_dau.TRANG_THAI_HDON }}
                        </span>
                    </div>
                </div>
                
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-semibold text-gray-900">Tổng tiền:</span>
                        <span class="text-2xl font-bold text-blue-600">{{ hoa_don_bat_dau.TONG_TIEN|floatformat:0 }} VNĐ</span>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'user_hopdong:xem_hoa_don' hoa_don_bat_dau.MA_HOA_DON %}" 
                   class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition">
                    <i class="fas fa-eye mr-2"></i>
                    Xem chi tiết hóa đơn
                </a>
                
                <a href="{% url 'user_hopdong:xuat_hoa_don_pdf' hoa_don_bat_dau.MA_HOA_DON %}" 
                   class="inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 transition">
                    <i class="fas fa-download mr-2"></i>
                    Tải PDF
                </a>
                
                <button onclick="shareInvoice()" 
                        class="inline-flex items-center px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 transition">
                    <i class="fas fa-share mr-2"></i>
                    Chia sẻ
                </button>
            </div>
        </div>
        {% endif %}

        <!-- Hướng dẫn tiếp theo -->
        <div class="bg-yellow-50 rounded-lg border border-yellow-200 p-6 mb-6">
            <h3 class="text-lg font-semibold text-yellow-800 mb-4 flex items-center">
                <i class="fas fa-lightbulb text-yellow-600 mr-2"></i>
                Các bước tiếp theo
            </h3>
            
            <div class="space-y-3">
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-yellow-100 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-xs font-semibold text-yellow-800">1</span>
                    </div>
                    <div>
                        <p class="text-yellow-800 font-medium">Thanh toán hóa đơn bắt đầu</p>
                        <p class="text-yellow-700 text-sm">Thanh toán hóa đơn để hoàn tất quá trình thuê phòng</p>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-yellow-100 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-xs font-semibold text-yellow-800">2</span>
                    </div>
                    <div>
                        <p class="text-yellow-800 font-medium">Liên hệ chủ trọ</p>
                        <p class="text-yellow-700 text-sm">Liên hệ để nhận chìa khóa và bàn giao phòng vào ngày nhận phòng</p>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-6 w-6 rounded-full bg-yellow-100 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-xs font-semibold text-yellow-800">3</span>
                    </div>
                    <div>
                        <p class="text-yellow-800 font-medium">Theo dõi hóa đơn hàng tháng</p>
                        <p class="text-yellow-700 text-sm">Hóa đơn hàng tháng sẽ được tạo tự động vào ngày {{ hop_dong.NGAY_THU_TIEN }} hàng tháng</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Thao tác</h3>
            
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'user_hopdong:thong_tin_hop_dong' hop_dong.MA_HOP_DONG %}" 
                   class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition">
                    <i class="fas fa-info-circle mr-2"></i>
                    Xem thông tin hợp đồng đầy đủ
                </a>
                
                <a href="{% url 'user_hopdong:hop_dong_list' %}" 
                   class="inline-flex items-center px-6 py-3 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 transition">
                    <i class="fas fa-list mr-2"></i>
                    Danh sách hợp đồng
                </a>
                
                <a href="/" 
                   class="inline-flex items-center px-6 py-3 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 transition">
                    <i class="fas fa-home mr-2"></i>
                    Về trang chủ
                </a>
            </div>
        </div>

    </div>
</div>

<script>
function shareInvoice() {
    if (navigator.share) {
        navigator.share({
            title: 'Hóa đơn bắt đầu hợp đồng',
            text: 'Hóa đơn bắt đầu hợp đồng thuê phòng {{ hop_dong.MA_PHONG.TEN_PHONG }}',
            url: '{% url "user_hopdong:xem_hoa_don" hoa_don_bat_dau.MA_HOA_DON %}'
        });
    } else {
        // Fallback cho browser không hỗ trợ Web Share API
        const url = window.location.origin + '{% url "user_hopdong:xem_hoa_don" hoa_don_bat_dau.MA_HOA_DON %}';
        navigator.clipboard.writeText(url).then(() => {
            alert('Đã sao chép link hóa đơn vào clipboard!');
        });
    }
}
</script>
{% endblock %}